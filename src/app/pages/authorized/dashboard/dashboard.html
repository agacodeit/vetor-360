<div class="dashboard">
    <div class="dashboard__new-solicitation">
        <ds-button label="Criar solicitação" icon="fa-regular fa-square-plus" iconSize="20"
            (onClickEmitter)="openCreateSolicitationModal()" [rounded]="true" />
    </div>

    <div class="dashboard__filters">
        <h2 class="filters-title">Filtros</h2>
        <div class="filters-grid">
            <ds-input label="Busca" width="400px" placeholder="Busque por nome do cliente" type="text"
                [(ngModel)]="filterClientName" (ngModelChange)="applyFilters()" />

            <ds-select label="Status" width="200px" placeholder="Selecione" [options]="statusFilterOptions"
                [(ngModel)]="filterStatus" (selectionChanged)="applyFilters()" />
        </div>
    </div>

    <div class="dashboard__content">
        @if (isLoadingKanban) {
        <p>Carregando solicitações...</p>
        } @else if (errorMessage) {
        <p>{{ errorMessage }}</p>
        } @else if (shouldShowKanban) {
        <ds-kanban [columns]="kanbanColumns" [showCardCount]="true" (cardMoved)="onCardMoved($event)"
            (cardAdded)="onCardAdded($event)" (cardRemoved)="onCardRemoved($event)" [columnsLoading]="columnsLoading"
            (columnAdded)="onColumnAdded($event)" (columnRemoved)="onColumnRemoved($event)"
            (columnRenamed)="onColumnRenamed($event)" (cardClicked)="onCardClick($event)">

            <ng-template #cardTemplate let-card let-column="column">
                <ds-card class="kanban-card" size="sm" variant="bordered" borderRadius="md">

                    <div class="__card-header">
                        <div class="d-flex align-items-center gap-4">
                            <ds-icon icon="fa-regular fa-square-minus" fontSize="24px" />
                            <h4>{{ card.title }}</h4>
                        </div>
                        <ds-icon icon="fa-regular fa-circle-right" fontSize="24px" />
                    </div>

                    <div class="__card-description">
                        <p>{{ card.client || '-' }}</p>
                        <p>{{ card.cnpj || '-' }}</p>

                        <hr>

                        <p>{{ card.data?.operationLabel || 'FGI' }}</p>
                        <p>{{ card.data?.valueLabel || 'R$ 0,00' }}</p>
                        <div class="card-icon">
                            <ds-icon icon="fa-regular fa-folder-open" color="gray-medium" fontSize="20px" />
                            <p>{{ card.data?.documentsSummary?.completed || 0 }}/{{ card.data?.documentsSummary?.total
                                || 0 }} Documentos</p>
                        </div>

                    </div>

                </ds-card>
            </ng-template>

        </ds-kanban>
        } @else if (shouldShowEmptyState) {

        <div class="welcome-msg">
            <i class="fa-regular fa-file"></i>

            <p class="bold">Ainda não há solicitações cadastradas.</p>

            <ds-button label="Criar solicitação" icon="fa-regular fa-square-plus" iconSize="20"
                (onClickEmitter)="openCreateSolicitationModal()" [rounded]="true" />
        </div>
        }
    </div>

    @if (!isLoadingKanban && !errorMessage && pagination.totalPages > 1) {
    <div class="dashboard__pagination">
        <ds-button label="Anterior" variant="outline" [disabled]="pagination.first"
            (onClickEmitter)="goToPreviousPage()" />
        <span>Página {{ pagination.page + 1 }} de {{ pagination.totalPages }}</span>
        <ds-button label="Próxima" variant="outline" [disabled]="pagination.last" (onClickEmitter)="goToNextPage()" />
    </div>
    }
</div>

@if(isCreateModalOpen) {
<ds-modal modalId="create-solicitation" (modalClosed)="onCreateModalClosed($event)">
    <app-solicitation-modal (onClose)="onCreateModalClosed($event)" (onSubmit)="onCreateModalClosed($event)">
    </app-solicitation-modal>
</ds-modal>
}

@if(isDocumentsModalOpen) {
<ds-modal modalId="documents-modal" (modalClosed)="onDocumentsModalClosed($event)">
    <app-documents-modal [solicitationData]="documentsSolicitationData" (onClose)="onDocumentsModalClosed($event)"
        (onSubmit)="onDocumentsSubmit($event)">
    </app-documents-modal>
</ds-modal>
}

@if(isDetailsModalOpen) {
<ds-modal modalId="solicitation-details" (modalClosed)="onDetailsModalClosed($event)">
    <app-solicitation-details (onClose)="onDetailsModalClosed($event)"></app-solicitation-details>
</ds-modal>
}